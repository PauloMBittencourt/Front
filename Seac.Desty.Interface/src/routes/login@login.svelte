<script lang="ts">
	import { goto } from '$app/navigation';
	import { Circle } from 'svelte-loading-spinners';
	var login = {
		matricula: '',
		password: ''
	};
	let err = '';
	let click: boolean = false;

	function setClick() {
		click = false;
	}

	async function handleLogin() {
		click = true;
		const res = await fetch('/login', {
			method: 'POST',
			headers: {
				accept: 'application/json'
			},
			body: JSON.stringify({ matricula: login.matricula, password: login.password })
		});
		if (res.status === 200) {
			await goto('/');
		} else if (res.status !== 200) {
			const data = await res.json();
			err = data.error;
		} else {
			err = 'Ocorreu um erro desconhecido';
		}
	}
</script>

<svg
	class="absolute top-0 -right-1"
	width="146"
	height="144"
	viewBox="0 0 73 72"
	fill="none"
	xmlns="http://www.w3.org/2000/svg"
>
	<path
		d="M72.093 72V0H0.0929625C-0.746317 1.61498 3.41193 24.568 41.2049 30.888C68.6087 35.4786 59.0714 58.9657 72.093 72Z"
		fill="#E23C51"
	/>
</svg>
<svg
	class="absolute bottom-0 left-0"
	width="146"
	height="144"
	viewBox="0 0 73 72"
	fill="none"
	xmlns="http://www.w3.org/2000/svg"
>
	<path
		d="M5.34058e-05 0V72H72.0001C72.8393 70.385 68.6811 47.432 30.8881 41.112C3.48433 36.5214 13.0216 13.0343 5.34058e-05 0Z"
		fill="#E23C51"
	/>
</svg>
<div class="flex flex-col items-center justify-center h-screen bg-cinza-desty-050">
	<div class="bg-white w-fit p-5 pt-16 pb-16 flex flex-col items-center rounded-lg shadow-md">
		<svg
			width="416"
			height="72"
			viewBox="0 0 216 72"
			fill="none"
			xmlns="http://www.w3.org/2000/svg"
			class="mb-8"
		>
			<g clip-path="url(#clip0_478_2625)">
				<path
					d="M172.567 22.2468C172.567 22.2468 172.397 22.4437 172.567 22.4718C175.351 23.0062 181.373 24.6375 186.259 29.475C191.145 34.3125 192.792 40.275 193.332 43.0312C193.332 43.1718 193.559 43.1437 193.559 43.0312V22.2468H172.595H172.567Z"
					fill="#E23C51"
				/>
				<path
					d="M214.296 19.5187C210.66 15.7218 204.808 17.0437 201.768 14.1187C198.814 11.0812 200.149 5.31559 196.314 1.71559C195.661 1.06871 194.809 0.478088 193.73 0.0280885C193.644 -3.65432e-05 193.559 0.0280885 193.559 0.140588C193.559 2.22184 193.559 22.275 193.559 22.275C193.559 22.275 213.813 22.275 215.915 22.275C216 22.275 216.057 22.1906 216.028 22.1062C215.545 21.0093 214.977 20.1937 214.324 19.5468L214.296 19.5187Z"
					fill="#E23C51"
				/>
				<path
					d="M24.7702 23.4844C23.776 22.9781 22.6113 22.5 21.2194 22.0781C19.8559 21.6562 18.2652 21.4594 16.4756 21.4594C13.8339 21.4594 11.5046 21.9094 9.45932 22.8375C7.44248 23.7375 5.70971 25.0594 4.28941 26.7187C2.8691 28.4062 1.78967 30.4312 1.07952 32.7937C0.340959 35.1562 -0.0283203 37.7719 -0.0283203 40.6687C-0.0283203 43.5656 0.284147 46.3219 1.27836 48.6281C3.09635 52.8469 7.27205 59.8219 16.5608 59.8219C22.3557 59.8219 24.685 56.1656 24.7418 56.0812L25.3099 58.7531H33.3204V4.5L24.7418 5.90625V23.5125L24.7702 23.4844ZM24.7702 37.3781V49.5562C24.685 49.7531 22.3557 52.4531 18.4072 52.4531C15.2542 52.4531 13.2657 51.3844 11.4761 49.275C9.68657 47.1375 8.77757 44.2125 8.77757 40.4719C8.77757 36.7312 9.48772 34.0312 10.9364 31.9219C12.3851 29.8125 14.6576 28.7719 17.7823 28.7719C19.2026 28.7719 20.5377 28.9969 21.7876 29.4469C23.0374 29.8969 24.0316 30.375 24.7986 30.8812V37.4062L24.7702 37.3781Z"
					fill="#E23C51"
				/>
				<path
					d="M54.6249 21.3187C52.466 21.3187 50.3356 21.7406 48.2619 22.5562C46.1883 23.3719 44.3419 24.5812 42.7511 26.2125C41.132 27.8156 39.8537 29.8406 38.8879 32.2875C37.9221 34.7062 37.4392 37.5469 37.4392 40.7812C37.4392 43.5375 37.8085 46.0687 38.5755 48.375C39.3424 50.6812 40.4787 52.7062 42.041 54.3937C43.6033 56.1094 45.5918 57.4312 47.9779 58.3875C50.3924 59.3437 53.2046 59.8219 56.4713 59.8219C57.7496 59.8219 58.9994 59.7656 60.2209 59.625C61.4424 59.4844 62.5786 59.3156 63.658 59.0906C64.7091 58.8937 65.6749 58.6406 66.4986 58.3875C67.3224 58.1344 67.9758 57.8812 68.4587 57.6562L67.3224 50.7094C66.3282 51.1312 64.9647 51.525 63.2604 51.8906C61.5276 52.2562 59.6244 52.4531 57.5507 52.4531C54 52.4531 51.3014 51.6375 49.455 50.0344C47.5802 48.4312 46.5292 46.1531 46.3019 43.2H70.7312C70.788 42.7219 70.8164 42.2156 70.8448 41.625C70.8448 41.0344 70.8732 40.5281 70.8732 40.05C70.8732 33.8344 69.4529 29.1656 66.5839 26.0437C63.7148 22.9219 59.738 21.3469 54.6533 21.3469L54.6249 21.3187ZM46.3303 36.9562C46.4723 35.8875 46.728 34.8187 47.0973 33.8062C47.4666 32.7656 48.0063 31.8656 48.688 31.0781C49.3698 30.2906 50.222 29.6437 51.1878 29.1375C52.182 28.6594 53.3466 28.4062 54.6533 28.4062C55.96 28.4062 57.011 28.6312 57.9484 29.0812C58.8574 29.5312 59.6528 30.1219 60.2777 30.9094C60.9026 31.6687 61.3855 32.5969 61.7264 33.6375C62.0673 34.6781 62.2093 35.8031 62.2093 36.9562H46.2735H46.3303Z"
					fill="#E23C51"
				/>
				<path
					d="M98.342 41.8218C97.433 40.9218 96.2399 40.1062 94.848 39.3749C93.4277 38.6437 91.695 37.9124 89.6781 37.1531C88.4567 36.7312 87.4057 36.3374 86.5535 35.9156C85.7013 35.5218 85.0195 35.1281 84.5082 34.7343C83.9969 34.3406 83.6277 33.9187 83.4004 33.4406C83.2016 32.9624 83.0879 32.4281 83.0879 31.8374C83.0879 30.6281 83.6276 29.7281 84.7071 29.1374C85.7865 28.5468 87.2068 28.2656 88.968 28.2656C90.8996 28.2656 92.604 28.4343 94.0527 28.7999C95.5014 29.1374 96.7229 29.5312 97.6603 29.9531L99.2226 23.0906C98.2284 22.7249 96.7513 22.3312 94.7628 21.9374C92.7744 21.5437 90.7008 21.3468 88.5419 21.3468C84.2526 21.3468 80.8439 22.3312 78.3441 24.2437C75.8444 26.1843 74.5945 28.8281 74.5945 32.2031C74.5945 33.9187 74.8786 35.3812 75.4183 36.5906C75.958 37.7718 76.6966 38.8124 77.6624 39.6281C78.5998 40.4718 79.736 41.2031 81.0143 41.8499C82.321 42.4687 83.7413 43.0874 85.3036 43.6499C87.8602 44.5781 89.6781 45.4499 90.786 46.2374C91.8938 47.0249 92.4619 48.0374 92.4619 49.2468C92.4619 50.5687 91.9506 51.4687 90.8996 52.0031C89.8486 52.5374 88.201 52.8187 85.9569 52.8187C83.7129 52.8187 81.6676 52.5937 79.9064 52.1156C78.1453 51.6374 76.6113 51.1593 75.3331 50.6531L73.856 57.7406C74.6513 58.0781 76.0432 58.4999 78.0316 59.0343C80.0201 59.5687 82.6334 59.8499 85.9001 59.8499C90.7576 59.8499 94.5072 58.9499 97.1205 57.1499C99.7339 55.3499 101.041 52.7062 101.041 49.1906C101.041 47.5593 100.842 46.1531 100.416 44.9718C99.9895 43.7906 99.3078 42.7499 98.3988 41.8499L98.342 41.8218Z"
					fill="#E23C51"
				/>
				<path
					d="M123.737 51.9469C122.544 52.2844 121.152 52.425 119.59 52.425C117.317 52.425 115.726 51.8063 114.789 50.5406C113.852 49.275 113.369 47.1656 113.369 44.2406V29.3063H126.549V22.2188H113.369V11.1656L104.79 12.5719V44.325C104.79 46.7438 104.989 48.9094 105.415 50.8219C105.841 52.7063 106.58 54.3375 107.602 55.6594C108.653 56.9813 110.045 58.0219 111.806 58.6969C113.568 59.4 115.783 59.7375 118.425 59.7375C120.584 59.7375 122.487 59.5125 124.078 59.0625C125.669 58.6125 126.975 58.1907 127.969 57.7688L126.549 51.0469C125.839 51.3281 124.873 51.6375 123.68 51.9469H123.737Z"
					fill="#E23C51"
				/>
				<path
					d="M152.598 35.8593C151.291 40.5562 149.871 44.9718 148.365 49.1343C147.456 47.1375 146.575 44.9437 145.666 42.6093C144.757 40.275 143.905 37.9125 143.11 35.55C142.315 33.1875 141.548 30.8531 140.866 28.575C140.184 26.2968 139.588 24.1593 139.133 22.1906H129.986C131.918 29.025 134.134 35.4656 136.633 41.5406C139.133 47.6156 141.718 53.2125 144.417 58.3593C143.479 60.5531 142.371 62.1843 141.121 63.225C139.872 64.2656 138.11 64.8 135.895 64.8C134.247 64.8 132.543 64.4625 130.838 63.8156L129.276 70.6218C129.929 70.9593 130.924 71.2406 132.23 71.5218C133.537 71.8031 134.844 71.9437 136.15 71.9437C138.139 71.9437 139.872 71.7187 141.406 71.2687C142.911 70.8187 144.275 70.1156 145.524 69.1312C146.746 68.1469 147.854 66.9093 148.848 65.4187C149.842 63.9281 150.808 62.1281 151.745 60.0187C156.773 48.7125 161.205 36.0843 165.039 22.1625H156.177C155.097 26.55 153.904 31.1062 152.569 35.8031L152.598 35.8593Z"
					fill="#E23C51"
				/>
			</g>
			<defs>
				<clipPath id="clip0_478_2625">
					<rect width="216" height="72" fill="white" />
				</clipPath>
			</defs>
		</svg>
		{#if click === false}
			<form on:submit|preventDefault={handleLogin}>
				<div class="flex flex-col font-semibold">
					{#if err === ''}
						<label for="usuario">Informe seu usu치rio</label>
						<input
							name="usuario"
							type="text"
							placeholder="Usu치rio"
							bind:value={login.matricula}
							class="border border-gray-300 p-2 pr-3 pl-3 rounded-sm mt-4 w-80 mb-5 text-azul-desty 
							hover:outline-azul-desty focus:outline-azul-desty focus:text-azul-desty"
						/>
					{:else}
						<label for="usuario">Informe seu usu치rio</label>
						<input
							name="usuario"
							type="text"
							placeholder="Usu치rio"
							bind:value={login.matricula}
							class="border border-vermelho-desty p-2 pr-3 pl-3 rounded-sm mt-4 w-80 mb-5 text-vermelho-desty 
							hover:outline-vermelho-desty focus:outline-vermelho-desty focus:text-vermelho-desty"
						/>
					{/if}
					<label for="senha">Informe sua senha</label>
					{#if err === ''}
						<input
							name="senha"
							type="password"
							placeholder="Senha"
							bind:value={login.password}
							class="border border-gray-300 p-2 pr-3 pl-3 rounded-sm mt-4 w-80 mb-9 text-azul-desty
hover:outline-azul-desty focus:outline-azul-desty focus:text-azul-desty"
						/>
					{:else}
						<input
							name="senha"
							type="password"
							placeholder="Senha"
							bind:value={login.password}
							class="border border-vermelho-desty p-2 pr-3 pl-3 rounded-sm mt-4 w-80 mb-0 text-vermelho-desty
hover:outline-vermelho-desty focus:outline-vermelho-desty focus:text-vermelho-desty"
						/>
						<span class="text-vermelho-desty mb-9">{err}</span>
					{/if}
					<button
						class="w-80 bg-vermelho-desty text-white p-3 pr-3 pl-3 rounded-br-md rounded-tl-md tracking-wide plus-jakarta-sans"
						type="submit">Entrar</button
					>
				</div>
			</form>
		{:else}
			{#await handleLogin()}
				<div class="flex p-2 pr-3 pl-3 mt-4  mb-5">
					<Circle size="160" color="#0B08B7" unit="px" duration="1s" />
				</div>
			{:then}
				{setClick()}
			{:catch}
				{setClick()}
			{/await}
		{/if}
	</div>
</div>
